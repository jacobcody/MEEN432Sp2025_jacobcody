C0 = 0.001;         %in N (these are just set values)
C1 = 0.001;       %in N/(m/s)

% parameters for calculation of C2 - Tesla Model X
Rho =1.225;          %Kg/m^3
A  = 2.7;           % m^2 (projected area of Tesla)
Cd = 0.24;           %Aerodynamic drag coefficient
C2 = 0.5*Rho*A*Cd;

%Vehicle stats for a Tesla Model X

M=2352; %car mass in kg
L=2.96; %distance between front and rear axles
h=0.6;  %CG height in m, no exact distance is known so this is an estimate
ha=0.80; %m(aerodynamic force action point height)
r = 0.254; %radius of wheel
Iw = 0.5*25*(r^2); %assuming 25 kg per tire

%conversion factor
mph2mps = 0.447;

%gear ratio from Tesla's website
%note that we're using the front gear ratio, the back one is 9.74

GR = 9.34;

%max torque
max_torque = 967;


% Assigning variables to workspace
assignin('base', 'C0', C0);
assignin('base', 'C1', C1);
assignin('base', 'Rho', Rho);
assignin('base', 'A', A);
assignin('base', 'Cd', Cd);
assignin('base', 'C2', C2);
assignin('base', 'M', M);
assignin('base', 'L', L);
assignin('base', 'h', h);
assignin('base', 'ha', ha);
assignin('base', 'r', r);
assignin('base', 'Iw', Iw);

%Torque values given in init value in class
scaleFactor = 0.75;
rpm = [0, 1000,2000,3000,4000,5000,6000,7000,8000,9000,10000,11000,12000];
maxtorque_motor = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
280, 280, 280, 220, 160, 110, 95, 75, 60, 55, 50, 40, 0;
280, 280, 275, 255, 240, 180, 140, 125, 95, 75, 70, 50, 0;
280, 280, 275, 260, 250, 220, 180, 150, 125, 100, 80, 70, 0;
280, 280, 275, 260, 250, 230, 200, 175, 140, 120, 100, 75, 0] * scaleFactor;
vbus = [250, 350, 500, 600, 700] * scaleFactor;

%Battery data
battery_capacity=[0, 0.01, .1, .2, .3, .4, .5, .6, .7, .8, .9, 1]; % soc
open_voltage=[0, 3.1,3.55,3.68,3.74,3.76,3.78,3.85,3.9,3.95,4.08,4.15]; % OCV per cell
bat_Rint=0.1695; % internal resistance per cell
bat_capacity = 150; % Amp hr total battery capacity
series_bat = 96;
parallel_bat = 74;

%Contour plot information

Motor_eta_torque = [0:25:325] * 280/325 * scaleFactor;
Motor_eta_speed = [0:500:10000];
Motor_eta_speed(1) = 10;
Motor_eta_val = [0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000;
    0.860000000000000,0.940000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.860000000000000,0.860000000000000,0.860000000000000,0.860000000000000,0.840000000000000,0.820000000000000,0.800000000000000,0.780000000000000,0.760000000000000,0.740000000000000;
    0.840000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.960000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.880000000000000;
    0.840000000000000,0.920000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.880000000000000;
    0.820000000000000,0.900000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.880000000000000,0.880000000000000;
    0.820000000000000,0.880000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.860000000000000,0.860000000000000;
    0.800000000000000,0.880000000000000,0.920000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.800000000000000,0.860000000000000,0.900000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.780000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.780000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.760000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.740000000000000,0.840000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.9000000000000000;
    .740000000000000,0.840000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.720000000000000,0.820000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000];

Motor_eta_val = Motor_eta_val .* Motor_eta_val;

%Contour plot visual, commenting out for submission since plot isn't needed
%figure
%[C,h] = contour( datMotor.eta_speed, datMotor.eta_torque, datMotor.eta_val);
%clabel(C,h)
%h.LineColor='k'
%xlabel('Speed (rpm)');
%ylabel('Torque (Nm)');
%title('Efficiency (%) Contour Maps - Project 3');
%grid
%hold on
%plot(datMotor.rpm,datMotor.maxtorque,'--')